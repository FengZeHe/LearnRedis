## 《Redis实战》笔记
这个文件记录的是《redis实战》的学习笔记 
- 图书中的github地址：https://github.com/josiahcarlson/redis-in-action/
- Go代码地址：https://github.com/josiahcarlson/redis-in-action/tree/master/golang

## Chapter1
## 做一个对文章投票的网站demo
- 要构建一个文章投票网站，我们首先要做的就是为了这个网站设置一些数值和限制条件：
1. 如果一篇文章获得了至少200张支持票（up vote），那么网站就认为这篇文章是一篇有趣的文章；
2. 假如这个网站每天发布1000篇文章，而其中的50篇符合网站对有趣文章的要求，那么网站要做的就是把这50篇文章放到文章列表前100位至少一天；
3. 另外，这个网站暂时不提供投反对票（down vote）的功能。
4. 为了产生一个能够随着时间流逝而不断减少的评分，程序需要根据文章发布的时间和当前时间来计算文章的评分。

- 构建文章投票网站除了需要计算文章评分之外，害需要使用redis结构存储网络上的各种信息
1. 对于网站里的每篇文章，程序都使用一个散列表来存储文章的标题、指向文章的网站、发布文章的用户、文章的发布时间、文章投票数等等。
![](./chapter1/pic1.png)
2. (:)来分隔名字的不同部分，如键名article:92617就使用了冒号来分隔单词article和文章ID号92617,以此来构建命名空间。

- 文章投票网站将两个有序集合来存储文章，一个有序集合的成员为文章ID，分值为文章的发布时间。第二个有序集合的成员同样为文章ID，而分值为文章的评分。
1. 通过这两个有序集合，网站既可以根据文章发布顺序来展示文章，又能通过评分高低来展示文章。
2. 为了防止用户对同一篇文章进行多次投票，网站需要为每一篇文章记录一个已投票用户名单。

- 发布并获取文章
1. 发布一篇新文章首先需要创建一个新的文章ID，这项工作可以通过一个计数器执行`INCR`命令来完成。接着程序需要使用`SADD`将文章发布者的ID添加到记录文章已投票用户的集合里。
并使用`EXPIRE`命令为这个集合设置一个过期时间，过期后自动删除。

- 如何取出评分最高的文章和最新发布的文章
1. 程序需要先试用`ZREVRANGE`命令取出多个文章ID，然后再对每个文章ID执行一次`HGETALL`命令来取出文章详细信息。


## Chapter2
## 使用Redis构建Web应用
1. 登录cookie
2. 购物车cookie
3. 缓存生成的网页
4. 缓存数据库行
5. 分析网页访问记录


### Web应用响应请求的步骤：
1. 服务端对客户端发来的请求(request)进行解析
2. 请求被转发给一个预定义的处理器(handler)
3. 处理器可能从数据库中取出数据
4. 处理器可能会根据取出的数据进行模板渲染(render)
5. 处理器向客户端返回渲染后的内容作为请求的相应(response)

### 处理登录会话(session)
- 有两种常见的方法可以将登录信息存储在cookie里卖弄，一是签名(signed)cookie,另一种是令牌(token) cookie。
#### 签名cookie
签名cookie通常会存储用户名，可能还有用户ID，用户最后一次登录时间。除了用户的相关信息外，签名cookie还包含一个签名，服务器
可以用这个签名来验证发浏览器发送的信息是否未经改动。

#### 令牌cookie
令牌cookie会在cookie里存储一串随机字节作为令牌，服务器可以根据令牌在数据库中查找令牌的拥有者。随着时间的推移，旧令牌会被新令牌取代。

#### 使用redis实现登录cookie功能
1. 首先使用一个散列表来存储登录cookie令牌和已登录用户之间的映射，要检查一个用户是否已经登录，需要根据给定的令牌来查找与之对应的用户，并在用户已经登录的状态下返回其ID。

#### 使用redis实现购物车
1. 购物车的定义：每个用户的购物车都是一个散列，这个案列存储了商品ID与商品订购数量之间的映射。

#### 网页缓存
1. 网站内容实际上不需要每次都动态生成。减少网站在动态生成内容上花的时间，可以降低网站处理相同负载所需的服务器数量，并让网站速度变快。
2. 在处理请求之前或之后添加层(layers)的能力，这些层通常被称为中间件(middleware)或者插件(plugin)。
3. 我们需要创建这样的层来调用redis函数：对于一个不能被缓存的请求，函数将直接生成并返回页面；对于可以被缓存的请求，函数首先会尝试从缓存里取出并返回被缓存的页面，
如果缓存页面不存在，那么函数会生成页面并将其缓存在redis里5分钟，最后再将页面返回给调用者。

### 使用redis记录日志
